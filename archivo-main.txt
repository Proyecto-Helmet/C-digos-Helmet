#Region  Project Attributes 
	#ApplicationLabel: HelmetAPPV3
	#VersionCode: 1
	#VersionName: 
	'SupportedOrientations possible values: unspecified, landscape or portrait.
	#SupportedOrientations: portrait
	#CanInstallToExternalStorage: False
#End Region


#Region  Activity Attributes 
	#FullScreen: False
	#IncludeTitle: True
#End Region

Sub Process_Globals
	'These global variables will be declared once when the application starts.
	'These variables can be accessed from all modules.
	Dim dni As String
	Dim clave As String
End Sub

Sub Globals
	'These global variables will be redeclared each time the activity is created.
	'These variables can only be accessed from this module.
	Private btnContinuarRegistro As Button
	Private edtxtClave As EditText
	Private edtxtDNI As EditText
	Private lblClave As Label
	Private lblDNI As Label
	Private pnlRegistroUsuario As Panel
	Private lblUno As Label
	Private lblErroneo As Label
	Private ProgressBar1 As ProgressBar
	Private btnIngresar As Button
	Private btnLimpiar As Button
	Private lblCandado As Label
	
	Dim usuarios As Usuarios
	
End Sub

Sub Activity_Create(FirstTime As Boolean)
	'Do not forget to load the layout file created with the visual designer. For example:
	Activity.LoadLayout("RegistroUsuario")
	Activity.Title="Helmet APP - Registrar Usuario"
	
	btnContinuarRegistro.Visible=True 'si no se ingresa nada, los botones están desactivados
	btnIngresar.Visible=True
	btnContinuarRegistro.Enabled=False
	btnIngresar.Enabled=False
	
	lblErroneo.Visible=False
	usuarios.Initialize
	
	'limpiar base de datos
	'usuarios.borrarTODO
	
	'agregar datos de prueba
'	usuarios.insertarDNICLAVE(33558904,1234)  'mara
'	usuarios.insertarDNICLAVE(33273698,1564)  'lucas
	
	'mostrar base de datos
	'Dim data As List
	usuarios.leerUSUARIOS
	
	
End Sub

Sub Activity_Resume

End Sub

Sub Activity_Pause (UserClosed As Boolean)

End Sub



Sub btnContinuarRegistro_Click

	Dim DNIusado As Boolean
	
	If edtxtDNI.Text.Length = 8 Then
		If edtxtClave.Text.Length = 4 Then
			
			DNIusado=usuarios.chequearDNI(edtxtDNI.Text)  'para chequear que el dni ingresado no exista en la base de datos, devuelve TRUE si ya esta usado y FALSE en caso contrario
			If DNIusado=True Then  'ya hay un usuario con el mismo DNI
				lblErroneo.Visible=True
				lblErroneo.Text="el DNI ingresado pertenece a un usuario ya registrado"
				Log("ya hay un dni registrado")
			Else        'DNI exitoso
				Log("--------------------------------------------")
				Log("dni ingresado válido")
				lblErroneo.Visible=False
				dni=edtxtDNI.Text
				clave=edtxtClave.Text
				usuarios.insertarDNICLAVE(dni,clave)
				ProgressBar1.Enabled=True
				Log("DNI y Clave ingresados en la base de datos")
				Log("DNI: "&dni)
				Log("CLAVE: "&clave)
				StartActivity("IngresarCascoID")
			End If
			
			
		Else
			lblErroneo.Text="clave errónea"
			lblErroneo.Visible=True
		End If
	Else
		lblErroneo.Text= "DNI erróneo"
		lblErroneo.Visible=True
	End If
	
End Sub

Sub edtxtClave_TextChanged (Old As String, New As String)
	If edtxtClave.Text <> ""  Then
		If edtxtDNI.Text<>"" Then
			btnContinuarRegistro.Enabled=True
			btnIngresar.Enabled=True
		Else
			btnContinuarRegistro.Enabled=False
			btnIngresar.Enabled=False
		End If
	Else
		btnContinuarRegistro.Enabled=False
		btnIngresar.Enabled=False
	End If
End Sub

Sub edtxtDNI_TextChanged (Old As String, New As String)
	If edtxtClave.Text <> ""  Then
		If edtxtDNI.Text<>"" Then
			btnContinuarRegistro.Enabled=True
			btnIngresar.Enabled=True
		End If
	
	Else
		btnContinuarRegistro.Enabled=False
		btnIngresar.Enabled=False
	End If
End Sub


Sub btnIngresar_Click
	Dim DniExistente As Boolean
	Dim ClaveCorrecta As Boolean
	DniExistente=False
	ProgressBar1.Visible=True
	
	
	If edtxtDNI.Text.Length = 8 Then
		If edtxtClave.Text.Length = 4 Then
			DniExistente= usuarios.chequearDNI(edtxtDNI.Text)  'chequea se existe el DNI ingresado
			If DniExistente=True Then    'si existe chequea que la clave coincida con el DNI ingresado
				ClaveCorrecta=usuarios.chequearCLAVE(edtxtDNI.Text,edtxtClave.Text)
				If ClaveCorrecta=True Then
					ProgressBar1.Visible=False
					actividad(edtxtDNI.Text) 'decide hacia que actividad enviar al usuario
					
				End If
				If ClaveCorrecta=False Then
					lblErroneo.Text="La clave no coincide con el DNI ingresado"
					lblErroneo.Visible=True
					ProgressBar1.Visible=False
				End If
			End If
			If DniExistente=False Then   'si no existe en la base de datos entrega un mensaje de error
				lblErroneo.Text="Usuario Inexistente, por favor registre su DNI y su Clave"
				lblErroneo.Visible=True
				ProgressBar1.Visible=False
			End If
		Else
			lblErroneo.Text="clave errónea"
			ProgressBar1.Visible=False
			lblErroneo.Visible=True
		End If
	Else
		lblErroneo.Text= "DNI erróneo"
		ProgressBar1.Visible=False
		lblErroneo.Visible=True
	End If
	
	
End Sub





Sub btnLimpiar_Click
	usuarios.borrarTODO
	usuarios.leerUSUARIOS
End Sub

Sub actividad (DniIngresado As String)
	Dim existeHelmetID As Boolean
	Dim existeMotoID As Boolean
	dni=edtxtDNI.Text
	existeHelmetID=usuarios.chequearHelmetId(DniIngresado)
'	existeMotoID=
	
	If existeHelmetID=True Then
		StartActivity("RegistrarVehiculo")
	Else
		StartActivity("IngresarCascoID")
	End If
End Sub


